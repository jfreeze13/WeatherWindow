<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="utf-8"/>
	  <title>Weather Window</title>
	  <link rel="stylesheet" type="text/css" href="MainScreenStyle.css">

	  <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>

	  <script language="javascript" type="text/javascript">
	  	var SeasonCook=0;
	  	var WeatherCook=0;
	  	var user;
	  	var wthrcook=0;
	  	var ssncook=0;

			//getCookie, checkCookie functions (modified) from w3schools
			function getCookie(cname) {
			    var name = cname + "=";
			    var ca = document.cookie.split(';');
			    for(var i = 0; i < ca.length; i++) {
			        var c = ca[i];
			        while (c.charAt(0) == ' ') {
			            c = c.substring(1);
			        }
			        if (c.indexOf(name) == 0) {
			            return c.substring(name.length, c.length);
			        }
			    }
			    return "";
			}

			var checkCookie = function() {
			    user=getCookie("username");
			    if (user != "") {
			        document.getElementById("cookieuser").innerHTML = (user);
			    } else {
						window.location = "/Login.html\r\n";
			    }
			}

			//logoutfunction
			function logOut(){
				document.cookie=" username=deleted; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT";
				document.cookie ="chk=deleted; expires=Thu, 01 Jan 1920 00:00:00 GMT";
				document.cookie ="wthr=deleted; expires=Thu, 01 Jan 1920 00:00:00 GMT";
				document.cookie ="ssn=deleted; expires=Thu, 01 Jan 1920 00:00:00 GMT";
				document.cookie ="presNum=deleted; expires=Thu, 01 Jan 1920 00:00:00 GMT";
			}


	 	function loadSong(AudioFileName){
		  var player=document.getElementById('player');
			var sourceaudio=document.getElementById('player');
		  sourceaudio.src=AudioFileName;
		  player.load(); //just start buffering (preload)
		  player.play(); //start playing
		}

		function presets(option){
			console.log(WeatherCook);
			console.log(SeasonCook);
			if(document.getElementById('saveorload').checked){
				console.log("checked");
				document.cookie ="chk=checked; expires=Thu, 01 Jan 2020 00:00:00 GMT";
				document.cookie ="wthr="+String(WeatherCook)+"; expires=Thu, 01 Jan 2020 00:00:00 GMT";
				document.cookie ="ssn="+String(SeasonCook)+"; expires=Thu, 01 Jan 2020 00:00:00 GMT";
				document.cookie ="presNum="+option+"; expires=Thu, 01 Jan 2020 00:00:00 GMT";
			}else{
				console.log("unchecked");
				document.cookie ="chk=unchecked; expires=Thu, 01 Jan 2020 00:00:00 GMT";
				document.cookie ="presNum="+option+"; expires=Thu, 01 Jan 2020 00:00:00 GMT";
				document.cookie ="wthr="+String(WeatherCook)+"; expires=Thu, 01 Jan 2020 00:00:00 GMT";
				document.cookie ="ssn="+String(SeasonCook)+"; expires=Thu, 01 Jan 2020 00:00:00 GMT";
			}

			$.ajax({
               	url: '../cgi-bin/PresetsSave.py',  // lecture 8 script to query the pizza database

               	data: {                       // the data to send

                   	usr: user
               	},

               	type: "POST",                  // GET or POST

               	dataType: "text",             // html format

               	success: function(response) {   // function to execute upon a successful request
               		console.log("success for database!");
               		if(!(document.getElementById('saveorload').checked)){
                   		console.log("Fetching Cookies");
                   		ssncook = getCookie("ssn");
                   		console.log(ssncook);
                   		wthrcook = getCookie("wthr");
                   		console.log(wthrcook);
                   		var SeasonImg=0;
	  					if(ssncook == "\"url('flowing_grass.gif')\""){
	  						SeasonImg = "url('flowing_grass.gif')";
	  						console.log("in grass")
	  					} else if (ssncook == "\"url('running_water.gif')\"") {
	  						console.log("in water")
	  						SeasonImg = "url('running_water.gif')";
	  					} else if (ssncook == "\"url('foggy_mountain.gif')\"") {
	  						console.log("in fog")
	  						SeasonImg = "url('foggy_mountain.gif')";
	  					} else if (ssncook == "\"url('cold_lake.gif')\"") {
	  						console.log("in cold")
	  						SeasonImg = "url('cold_lake.gif')";
	  					}else{
	  						console.log("in else")
	  					}
	  					document.body.style.backgroundImage = SeasonImg;

	  					var WeatherImg=0;
	  					if (wthrcook == 'none'){
	  						WeatherImg = "none";
	  					} else if (wthrcook == "\"url('falling_rain.gif')\""){
	  						WeatherImg = "url(\"falling_rain.gif\")";
	  					} else if (wthrcook == "\"url('falling_snow.gif')\"") {
	  						WeatherImg = "url(\"falling_snow.gif\")";
	  					} else if (wthrcook == "\"url('falling_leaves.gif')\"") {
	  						WeatherImg = "url(\"falling_leaves.gif\")";
	  					}
	  					document.getElementById("OverlayImage").style.backgroundImage =WeatherImg;
                   	}
               	},

               	error: function(request) {   // function to call when the request fails
                   	console.log("error for database!");
                   		//console.log(data);
                   	console.log(request);

               	}
           	});
			//wthrcook = getCookie("wthr");
            //console.log(wthrcook);
            //document.body.style.backgroundImage = "url(\'cold_lake.gif\')";;
		}
		function changeSeason(SeasonKey) {
	  		var SeasonImage=0;
	  		if(SeasonKey == 'flowing_grass.gif'){
	  			SeasonImage = "url(\"flowing_grass.gif\")";
	  			SeasonCook='url(\'flowing_grass.gif\')';
	  		} else if (SeasonKey == 'running_water.gif') {
	  			SeasonImage = "url(\"running_water.gif\")";
	  			SeasonCook='url(\'running_water.gif\')';
	  		} else if (SeasonKey == 'foggy_mountain.gif') {
	  			SeasonImage = "url(\"foggy_mountain.gif\")";
	  			SeasonCook='url(\'foggy_mountain.gif\')';
	  		} else if (SeasonKey == 'cold_lake.gif') {
	  			SeasonImage = "url(\'cold_lake.gif\')";
	  			SeasonCook="url(\'cold_lake.gif\')";
	  		}
	  		document.body.style.backgroundImage = SeasonImage;

	  	}

	  	function changeWeather(WeatherKey) {
	  		var WeatherImage=0;
	  		if (WeatherKey == 'none'){
	  			WeatherImage = "none";
	  			WeatherCook='none';
	  		} else if (WeatherKey == 'falling_rain.gif'){
	  			WeatherImage = "url(\"falling_rain.gif\")";
	  			WeatherCook='url(\'falling_rain.gif\')';
	  		} else if (WeatherKey == 'falling_snow.gif') {
	  			WeatherImage = "url(\"falling_snow.gif\")";
	  			WeatherCook='url(\'falling_snow.gif\')';
	  		} else if (WeatherKey == 'falling_leaves.gif') {
	  			WeatherImage = "url(\"falling_leaves.gif\")";
	  			WeatherCook="url(\'falling_leaves.gif\')";
	  		}
	  		document.getElementById("OverlayImage").style.backgroundImage =WeatherImage;
	  	}

			function checkDate() {
					var d = new Date();
					var time = new Date();
					var hour = time.getHours();
					var timebg;
					if (hour >= 6 && hour < 8) {
						//sunrise background - preset 1
						timebg = "";
						presets(1);
					} else if (hour >= 8 && hour < 17) {
						//day background - preset 2
						timebg = "";
						presets(2);
					} else if (hour >= 17 && hour <19) {
						//sunset background - preset 3
						timebg = "";
						presets(3);
					} else {
						//night background - preset 4
						timebg = "";
						presets(4);
					}
					document.getElementById("time").innerHTML = d.toLocaleTimeString();
			}
			setInterval(checkDate, 1000);

    </script>

	</head>

	<body onload="checkCookie();">
		<div id=OverlayImage>
			<img href="http://68.media.tumblr.com/00ce33ba22ab2574dcbf2b5ffe3cbefb/tumblr_mtyk1xWdBM1s5jjtzo1_500.gif">
		</div>
	  	<div id="AudioControl">
	  		<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Speaker_Icon.svg/2000px-Speaker_Icon.svg.png" alt="Volume!" style="width:30px;height:30px">
	  	</div>

			<div id="DayNight">
				<div id="time"></div>
			</div>

	  <div id="WeatherControl">
		  <div>
			  <button onclick="changeSeason('flowing_grass.gif')">Spring</button>
			  <button onclick="changeSeason('running_water.gif')">Summer</button>
			  <button onclick="changeSeason('foggy_mountain.gif')">Autumn</button>
			  <button onclick="changeSeason('cold_lake.gif')">Winter</button>
			 </div>
		  <div>
		    <button onclick="changeWeather('none')">None</button>
		    <button onclick="changeWeather('falling_rain.gif')">Rainy</button>
		    <button onclick="changeWeather('falling_snow.gif')">Snowy</button>
		    <button onclick="changeWeather('falling_leaves.gif')">Leafy</button>
		  </div>
	  </div>

	  <div id="SoundSettings">
	  	<audio id="player" controls="controls" loop>
	  		<source src="sourceaudio" type="audio/mpeg">
	  		Your browser does not support this!
	  	</audio>
	  	<br>
		  <button onclick='loadSong(null)'>Off</button>
		  <button onclick='loadSong("rain2hard.mp3")'>Hard Rain</button>
		  <button onclick='loadSong("rain-and-birds.mp3")'>Rain With Birds</button>
		  <button onclick='loadSong("Wind-Mark_DiAngelo-1940285615.mp3")'>Wind Blowing</button>
	  </div>


	  <form id="PresetSettings" method="post">
	  	  <input type = "checkbox" class="presetbox" id="saveorload">
		  <button onclick='presets(1); return false;'>1</button>
		  <button onclick='presets(2); return false;' >2</button>
		  <button onclick='presets(3); return false;'>3</button>
		  <button onclick='presets(4); return false;'>4</button>
	  </form>

	  <div id="AccountFunctions">
	  	<!--Here, pull Username, and have a Logout button-->
		<h2 id="cookieuser"></h2>
		<form id="login" method="post" action="/cgi-bin/logout.py" >
  			<input type="submit" onclick="logOut()" name="Logout" value="Log Out">
  		</form>
	  </div>

	</body>
</html>
